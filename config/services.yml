---
# This file is auto-generated during the composer install
parameters:
    # définition des ROOT
    system_path:		'%root_path%/system'
    classes_path:       '%system_path%/Classes'
    
    modules: 		'%system_path%/Modules/'
    lib: 			'%classes_path%/lib/'
    config: 		'%system_path%/config/'
    event: 		'%system_path%/event/'
    
    inscription: 	'%system_path%/inscription/'
    connection: 	'%system_path%/connection/'
    
    action: 		'%system_path%/action/std/'
    ajax: 			'%system_path%/action/ajax/'
    
    api: 			'%system_path%/api/'
    script:		'%system_path%/script/'
    buffer:		'%system_path%/buffer/'
    
    template: 		'%system_path%/views/templates/'
    pages: 		'%system_path%/views/pages/'
    component: 	'%system_path%/views/components/'
    session_lifetime: 1800
    log_directory: var/logs
    log_rotation: 3
    daily_script_hour: 3
    gaia.galaxy_configuration.class: Asylamba\Modules\Gaia\Galaxy\GalaxyConfigurationV6
    game.available_factions: [1, 2, 3, 4, 7]
    
    
    facebook_link: 'https://www.facebook.com/asylamba'
    google_plus_link: 'https://plus.google.com/+Asylamba-game'
    twitter_link: 'https://twitter.com/asylamba'
  
    # asm constantes
    asm_umode: true
  
    # event constantes
    event_base: 0 # correspond à une construction (batiment ou vaisseau) dans une base
    event_outgoing_attack: 1
    event_incoming_attack: 2
  
    # constante de temps pour la mise à jour des événements dans loadEvent.php
    # 300 s = 5 minutes
    time_event_update: 300
  
    # constantes pour le contre-espionnage
    antispy_out_of_circle:	0
    antispy_big_circle:	1
    antispy_middle_circle: 2
    antispy_little_circle: 3
  
    # pour Game::antiSpyRadius()
    antispy_display_mode: 0
    antispy_game_mode: 1

    nb_avatar: 80
    pam_coeftax: 1
    rsm_researchquantity: 10
  
    # durée en heures avant que le classement total démarre
    # 2 semaines = 336 h
    # 20 jours = 480h
    hours_before_start_of_ranking: 480
    points_to_win: 2000


    publicr: '/public/'
    css: '%publicr%css/'
    js: '%publicr%js/'
    media: '%publicr%media/'
    log: '%publicr%log/'
    # active les APIs de confirmation
    # active la création de personnage au niveau 5
    highmode: true
    # active les feuilles de style multiples par faction
    # note : les style peuvent ne pas être à jour
    color_style: true
    # active l'ajout du script analytics
    analytics: false
    # active la captation des données d'analyse (TB)
    data_analysis: false
    #########
    # INFOS #
    #########
    # défini le nom du tableau de session
    # note : utile si plusieurs instances cohabitent sur la même machine
    server_sess: 'server'
    # défini le titre du serveur (affiché comme titre)
    app_name: 'Asylamba'
    # défini le sous-titre du serveur (affiché comme titre)
    app_subname: 'Expansion Stellaire'
    # numéro de version de l'app
    app_version: '2.0.0'
    # créateurs du projet
    app_creator: 'Gil Clavien, Jacky Casas, Noé Zufferey'
    # défini la description du serveur (affichée dans la page)
    app_description: 'Asylamba, jeu par navigateur'
    #################
    # MISCELLANEOUS #
    #################
    # définition des ids des différants joueurs systèmes
    id_gaia: 1
    id_jeanmi: 2
    shift_faction: 2
    # date de début du serveur


services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: true
        bind:
            $container: '@container'

    Asylamba\Classes\Database\Database:
        public: true
        arguments:
            $host: "%database_host%"
            $name: "%database_name%"
            $user: "%database_user%"
            $password: "%database_password%"
            
    Asylamba\Classes\Database\DatabaseAdmin:
        arguments:
            $host: "%database_host%"
            $name: "%database_name%"
            $user: "%database_admin_user%"
            $password: "%database_admin_password%"

    Asylamba\Classes\EventListener\SchedulerInitListener:
        tags:
            - { name: 'kernel.event_listener', event: 'app.server_init', method: 'onServerInit' }

    Symfony\Component\Messenger\Bridge\Amqp\Transport\Connection:
        factory: ['Symfony\Component\Messenger\Bridge\Amqp\Transport\Connection', 'fromDsn']
        arguments: ['%env(RABBITMQ_DSN)%']

    Symfony\Component\Messenger\Bridge\Amqp\Transport\AmqpReceiver: ~

    Asylamba\Classes\Messenger\SendersLocator:
        factory: ['Asylamba\Classes\Messenger\SendersLocator', 'instanciate']

    messenger.default_bus:
        class: Symfony\Component\Messenger\MessageBus
        factory: ['Asylamba\Classes\Messenger\BusFactory', 'createBus']
        arguments:
            $handlersLocator: '@messenger.default_bus.messenger.handlers_locator'
        tags:
            - { name: 'messenger.bus' }

    Symfony\Component\Messenger\MessageBusInterface:
        alias: 'messenger.default_bus'

    Symfony\Component\Messenger\Worker:
        public: true
        arguments:
            $receivers: ['@Symfony\Component\Messenger\Bridge\Amqp\Transport\AmqpReceiver']

    Asylamba\Classes\Library\Session\SessionWrapper: ~
            
    Asylamba\Classes\Scheduler\CyclicActionScheduler:
        public: true
        arguments:
            $dailyScriptHour: "%daily_script_hour%"
            
    Asylamba\Classes\Router\Router:
        arguments:
            $appRoot: '%app_root%'
            $rootPath: '%root_path%'
            $getOutRoot: "%getout_root%"
            $actionPath: '%action%'
            $ajaxPath: '%ajax%'
            $connectionPath: '%connection%'
            $registrationPath: '%inscription%'
            $bufferPath: '%buffer%'
            $apiPath: '%api%'
            $templatePath: '%template%'
            $scriptPath: '%script%'
            $pagesPath: '%pages%'
            $eventPath: '%event%'

    Asylamba\Classes\Library\Http\RequestFactory: ~
        
    Asylamba\Classes\Library\Http\ResponseFactory:
        
    Asylamba\Classes\Daemon\ClientManager:
        arguments:
            $sessionLifetime: "%session_lifetime%"
        
    Asylamba\Classes\Templating\Renderer: ~
            
    Asylamba\Classes\Daemon\Server:
        public: true
        arguments:
            $statefulManagers: !tagged_iterator app.stateful_manager
            $serverCycleTimeout: '%server_cycle_timeout%'
            $port: '%server_port%'
            $collectionCyclesNumber: '%server_collection_cycles_number%'

    Asylamba\Classes\Entity\EntityManager:
        public: true

    Asylamba\Classes\Logger\ConsoleLogger: ~

    Asylamba\Classes\Logger\FileLogger:
        arguments:
            $logDirectory: "%log_directory%"
            $logRotation: "%log_rotation%"

    Psr\Log\LoggerInterface: '@Asylamba\Classes\Logger\ConsoleLogger'

    Asylamba\Classes\Library\Parser:
        arguments:
            $appRoot: '%app_root%'
            $mediaPath: '%media%'

    Asylamba\Classes\Worker\API:
        arguments:
            $serverId: "%server_id%"
            $apiKey: "%security_api_key%"
            $getOutRoot: "%getout_root%"

    Asylamba\Classes\Library\Security:
        arguments:
            $serverKey: "%security_server_key%"
            $iv: "%security_iv%"
        
    Asylamba\Classes\Worker\CTC:
        arguments:
            $logDirectory: "%log_directory%"
            
    Asylamba\Classes\Memory\MemoryManager: ~

    Asylamba\Classes\Redis\RedisManager:
        arguments:
            $host: '%env(REDIS_HOST)%'
            $port: '%env(int:REDIS_PORT)%'
            $password: '%env(default::REDIS_PASSWORD)%'
            $timeout: "%redis_timeout%"
        
    Asylamba\Classes\EventListener\ExceptionListener:
        arguments:
            $templatePath: '%template%'
        tags:
            - { name: "kernel.event_listener", event: "core.exception", method: "onCoreException" }
            - { name: "kernel.event_listener", event: "core.error", method: "onCoreError" }
